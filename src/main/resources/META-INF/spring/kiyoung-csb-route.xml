<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:camel="http://camel.apache.org/schema/spring"
       xsi:schemaLocation="
         http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
         http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">


    <import resource="classpath:/META-INF/spring/kiyoung-csb-common.xml" />

    <import resource="classpath:/META-INF/spring/kiyoung-csb-dataformat.xml"/>

    <!--이놈(1)-->
    <import resource="classpath:/META-INF/spring/kiyoung-csb-service.xml"/>

    <!--이놈(3) 임포트를 시켜야 FRONTEND_ROUTE 사용 가능-->
    <import resource="classpath:/META-INF/spring/kiyoung-csb-frontend.xml"/>


    <camelContext xmlns="http://camel.apache.org/schema/spring" trace="true">

        <!-- 이놈(3) 내가 삽질했던건, 위에 kiyoung-csb-frontend를 import 안시켰기 때문... -->
        <routeContextRef ref="FRONTEND_ROUTE"/>

        <routeContextRef ref="SERVICE_ROUTE"/>


        <!-- alivecheck -->
        <route>
            <from uri="servlet:/check?servletName=CSBServlet" />
            <process ref="deployCheck" />
        </route>

        <!-- csb/login -->
        <route>
            <from uri="servlet:/login?servletName=CSBServlet" />
            <!-- 로그인 라우터로 (아래) -->
            <to uri="direct:login" />
        </route>




        <route id="로그인라우터">
            <from uri="direct:login" />

            <!--&lt;!&ndash; 로그 설정 &ndash;&gt;-->
            <to uri="log:IN_MESSAGE?level=DEBUG&amp;showBody=true&amp;showHeaders=true&amp;multiline=false&amp;showExchangeId=true"/>

            <setHeader headerName="log_type"><constant>IN</constant></setHeader>

            <to uri="direct:front-requestProcess" /> <!--kiyoung-csb-frontend로 보냄-->
            <to uri="direct:login-sevice-call" />  <!--kiyoung-csb-service로 보냄-->



            <!--<setHeader headerName="log_type"><constant>OUT</constant></setHeader>-->
            <!--&lt;!&ndash; 			<removeHeaders pattern="*" excludePattern="Content-Type" /> &ndash;&gt;-->
            <!--<to uri="log:OUT_MESSAGE?level=DEBUG&amp;-->
                                   <!--showBody=true&amp;-->
                                <!--showHeaders=true&amp;-->
                                 <!--multiline=false&amp;-->
                                 <!--showExchangeId=true"/>-->

            <!--<convertBodyTo type="String" charset="{{ROUTE.CLIENT_ENCODING}}" />-->
        </route>
    </camelContext>

</beans>